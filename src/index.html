<!DOCTYPE html> 
<html> 
<head>
  <title>Enrich: empowering audio files</title>
  <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/1.1.0/annyang.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script>
  
  </script>
</head>

<body>
  <!-- Create an html5 audio player -->
  <audio id='myBook' controls ></audio> 
  <input type='file' id='selectedFile' 
  onchange='handleFiles(this.files)' /> 
  <button onclick="slowerPlayback()" type="button">slower</button>
  <button onclick="fasterPlayback()" type="button">faster</button>
  <br> 

  <script>

  // load in the mp3 file and create a handle. 
  function handleFiles(files){ 
          var myURL = window.URL || window.webkitURL
        	// console.log('winurl='+ myURL);
            var file = window.URL.createObjectURL(files[0]); 
            myBook = document.getElementById('myBook');
            myBook.src = file; 
            myBook.load();
            myBook.play();
        }

    // setting up some constants
    maxPlaybackRate = 1.75;
    minPlaybackRate = 0.5;


    // basic functions of the player that we will want to access
    function getPlaySpeed(){ 
        alert(myBook.playbackRate)
    } 

    // adjust playback speeds based on users input
    function fasterPlayback(){
      if (myBook.playbackRate < maxPlaybackRate){
        myBook.playbackRate=myBook.playbackRate + 0.25;
      }
    }
    function slowerPlayback(){ 
      if (myBook.playbackRate > minPlaybackRate){
          myBook.playbackRate=myBook.playbackRate - 0.25;
      }
    } 

    function pause(){
      myBook.pause();
    }

    function play(){
      myBook.play();
    }


    // voice commands
    "use strict";
    if (annyang) {
      var getPlaySpeed = function() {
        alert(myBook.playbackRate)
      };

      var fasterPlayback = function() {
        if (myBook.playbackRate < maxPlaybackRate){
           myBook.playbackRate=myBook.playbackRate + 0.25;
         }
      };

      var slowerPlayback = function() {
        if (myBook.playbackRate > minPlaybackRate){
           myBook.playbackRate = myBook.playbackRate - 0.25;
         }
      };

      var pause = function() {
        myBook.pause();
      };

      var play = function() {
        myBook.play();
      };


      // Let's define some commands
      var commands = {
          'wait':   pause,
          'pause':   pause,
          'stop':   pause,
          'go ahead':  play,
          'play':   play,
          'continue': play,
          'resume':   play,
          'faster':   fasterPlayback,
          'slower':   slowerPlayback,
          'current speed':   getPlaySpeed,
      };

        

        // Add our commands to annyang
        annyang.addCommands(commands);

        // Start listening.
        annyang.start();
    }
    else {
      alert('failed')
    }
  </script> 

</body> 
</html>